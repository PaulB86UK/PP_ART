---
title: 26/05/2020
permalink: /2020/26_5
---
[Go Back](https://paulb86uk.github.io/PP_ART.github.io/)

# Tuesday 26th of May of 2020

## ['Age'] Column Transformations
### Strategy 1: Building classes with aproximately same amount of data on each class/
I build 3 different blocks of coded to perform this task. The first one builds the classes limits in order to get a similar amoung of data on each class. 

```python
def bins_func(df,col):
  for i in range (20,30,1):
    num = len(df[col])/i
    if round(num) - num > 0.1:
      pass
    else:
      value = i
      break
  bins = []
  df = round(df.sort_values(by=col, ascending= True))
  for j  in range (0,len(df),value):
    bins.append(df[col].iloc[j])
  bins.append(df[col].iloc[len(df)-1])
  return bins
```
In the first part of this code I tried to forced each class to have n => 20. That is the reason why the range goes between 20 and 30, and the code will stop when the residual of the division is less than 0.1. In the second part,  I order the age values {A-Z}, and trigger for the value(the resulting i that has the lowest residual first), a kind of lookup method(iloc[j]), on the number that results after every moving a "value" range in the data. This way I found the class delimitators (similar amount of data in each) in the bins list.
The result is the following:

```python
bins = bins_func(age_train,'age')
bins
---------------------------------
[ 1., 17., 22., 25., 28., 31., 36., 38., 42., 47., 49., 54., 60., 80.]
```
The second part is to used this limits to actually build the classes columns. So in order to do that, I build this code:
```python
def continuos_num_to_cat_num(df,col,bins): #age_train,'Age'
    age_class = []
    for i in df[col]:
      i = int(i) #note: age should be a integer (?) xD
      if i < bins[1]:
        age_class.append(0) #17
      elif i < bins[2]:
        age_class.append(1) #22
      elif i < bins[3]:
          age_class.append(2) #25
      elif i < bins[4]:
          age_class.append(3) #28
      elif i < bins[5]:
        age_class.append(4) #31
      elif i < bins[6]:
        age_class.append(5) #36
      elif i < bins[7]:
        age_class.append(6) #38
      elif i < bins[8]:
        age_class.append(7) #42
      elif i < bins[9]:
        age_class.append(8) #47
      elif i < bins[10]:
        age_class.append(9) #49
      elif i < bins[11]:
        age_class.append(10) #54
      elif i < bins[12]:
        age_class.append(11) #60
      elif i < bins[13]:
        age_class.append(12) #80
      else:
        age_class.append(12) #80
    return age_class
```
And to perform this two task, this is the 3rd block of code.
```python
def age_into_class(df,col):
  bins = bins_func(df,col)
  df['age_class'] = continuos_num_to_cat_num(df,col,bins)
```
And the result is the following:
```python
age_train['age_class'].value_counts()
-----------------------------
5     27
10    23
2     23
12    22
11    22
8     22
6     21
7     20
1     20
4     18
3     18
9     16
0      8
Name: age_class, dtype: int64
```

So in this code, I only use the words that appear more than 5 times. The correlation selection is made when the function reorder() is triggered(not shown here, but can be seen in the repository, or previous post in the blog)

&nbsp;
&nbsp;
&nbsp;

## Column: Ticket. 
Similar to the cabin, this column had letters/numbers in some rows, and only numbers in others.
So the first step I did was to check all the strings that appear in every row, and asign each of them a number, make a list and create a new column.
After that I removed using the [ord](https://docs.python.org/3/library/functions.html?highlight=ord#ord)] and [translate](https://docs.python.org/3/library/stdtypes.html?highlight=translate#str.translate) python built-in functions the characters 'WPCS/.EOTFARI ' from the ticket column. 
Finally, I created another list, and asigned it to a new column. The code I used to perform both tasks is the following:

```python
def ty_ticket():
  #now the ticket columnn
   pc = []
  for i in age_train.ticket:
    if 'PC' in i:
      pc.append(1)
    elif 'PP' in i:
      pc.append(2)
    elif 'SC/P' in i:
      pc.append(3)
    elif 'C.A.' in i:
      pc.append(4)
    elif 'W.E.P.' in i:
      pc.append(5)
    elif 'SC/AH' in i:
      pc.append(6)  
    elif 'SOTON/O' in i:
      pc.append(7)
    elif 'F.C.' in i:
      pc.append(8)
    elif 'WE/P' in i:
      pc.append(9)
    elif 'S.O./P.' in i:
      pc.append(10)
    elif 'W./C.' in i:
      pc.append(11)
    elif 'aris' in i:
      pc.append(11)
    elif 'NQ' in i:
      pc.append(12)
    elif 'HBle' in i:
      pc.append(12)
    else:
      pc.append(0)
  age_train['PC'] = pc
  age_train['PC'] = age_train['PC'].astype(int)

  lesta = []
  for i in age_train.ticket:
    j = i.translate({ord(k): None for k in 'WPCS/.EOTFARINQHBlearis '})
    lesta.append(j)
  age_train['Ticket2'] = lesta
```
## Results
### How was the correlation between the features analized with the variable 'Age'?
As it can be seen from the table below, some of the words in the rows of the column name had strong correlation with the age, such Miss., Mr.,Mrs., as it was expected, but also names as Edward or Henry happened to show also some correlation.
Regarding the ticket column, only the number in the ticket shows correlation, while the letters on it did not. However the letter might be important later, when analizing and preparing the final model to predict if the person survived or not.

```python
Master.       -0.377010
pclass         0.338609
Miss.         -0.301639
Ticket2       -0.261481
cnumber        0.253341
parch          0.195196
Mr.            0.182777
Mrs.           0.163290
Edward         0.148433
Henry          0.147560
sibsp          0.122824
William        0.122804
James          0.117208
sex            0.108762
passengerid    0.108601
cnumloc        0.102749
embarked       0.079662
Elizabeth      0.067523
Thomas         0.047070
Frederick      0.045795
Walter         0.045795
Charles        0.042594
George         0.029324
fare           0.013872
Jr             0.012748
John          -0.007229
Fortune,      -0.005687
Name: 0, dtype: float64
```
Full Code (GITHUB) [here](https://github.com/PaulB86UK/EDA_PP/blob/master/EDA_Reorder_25_5_20_I.ipynb)

&nbsp:
Thanks for reading!!

### PP_ART

[Go Back](https://paulb86uk.github.io/PP_ART.github.io/)
